<!doctype html>
<html>
  <head>
    <title>Reverserver Test</title>
    <link rel="stylesheet" type="text/css" href="/styles.css">
    <meta charset="UTF-8"> 
  </head>
  <body>
    <input id='file_button' type='file'></input>
    <div id='hosted_files'>
      <h1>Hosted Files</h1>
    </div>
    <script src='/main.js'></script>
    <script>

    const host = window.location.hostname;
    const port = 8080;
    const rsServer = new reverserver.Server({ host, port });

    const file = new File(["Hi there"], "og.txt", {
      type: "text/plain",
    });

    rsServer.hostFile('/', file);

    const allUrls = [];

    const uploadButton = document.getElementById('file_button');
    uploadButton.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) {
        return;
      }

      const path = '/' + file.name;
      rsServer.hostFile(path, file);
      const fullPath = rsServer.getHostedPath(path);
      const url = `http://${window.location.hostname}:${port}${fullPath}`;

      if (allUrls.indexOf(url) === -1) {
        allUrls.push(url);
        const filesEl = document.getElementById('hosted_files');
        const div = document.createElement('div');
        div.style.fontSize = '22px';
        div.style.fontWeight = 'bold';
        div.innerHTML = `<a target='_blank' href=${url}>${url}</a>`;
        filesEl.appendChild(div);
      }
    });

    </script>
  </body>
</html>
