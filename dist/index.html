<!doctype html>
<html>
  <head>
    <title>browserve fileshare</title>
    <link rel="stylesheet" type="text/css" href="/styles.css">
    <meta charset="UTF-8"> 
  </head>
  <body>
    <input id='file_button' type='file'></input>
    <div id='hosted_files'>
      <h1>Hosted Files</h1>
    </div>
    <script src='/main.js'></script>
    <script>

    const proxyAddress = window.location.hostname;
    const port = 9001;
    const hoster = new browserve.Hoster({ proxyAddress, port, secure: false }, () => {

      const file = new File(["Hi there"], "og.txt", {
        type: "text/plain",
      });

      hoster.hostFile('/', file);

      const allUrls = [];

      const uploadButton = document.getElementById('file_button');
      uploadButton.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) {
          return;
        }

        const path = '/' + file.name;
        hoster.hostFile(path, file);
        const fullPath = hoster.getHostedPath(path);
        const portStr = hoster.getPortStr();
        const url = `${window.location.protocol}//${window.location.hostname}${portStr}${fullPath}`;

        if (allUrls.indexOf(url) === -1) {
          allUrls.push(url);
          const filesEl = document.getElementById('hosted_files');
          const div = document.createElement('div');
          div.style.fontSize = '22px';
          div.style.fontWeight = 'bold';
          div.innerHTML = `
            <div>
              <a target='_blank' href=${url}>${url}</a>
              <div>samtoolsgit view ${url} chr1:1-10000</div>
              <div>curl -v -H "Range: bytes=0-1000" ${url} > out.bam</div>
            </div>
          `;
          filesEl.appendChild(div);
        }
      });
    });

    </script>
  </body>
</html>
